# å‹•ãç«‹ã¡çµµæ©Ÿèƒ½ - ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å®Ÿè£…è¨ˆç”» (MVP)

## æ¦‚è¦

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç›®ãƒ»å£ãªã©ã®è¤‡æ•°ã®ãƒ‘ãƒ¼ãƒ„ç”»åƒã‚’çµ„ã¿åˆã‚ã›ã€å­—å¹•(éŸ³å£°)ã«åˆã‚ã›ã¦ãƒªãƒƒãƒ—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³(å£ãƒ‘ã‚¯)ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**MVPç‰ˆ**: éŸ³ç´ è§£æã¯è¡Œã‚ãšã€ç™ºè©±ä¸­ã«ä¸€å®šé–“éš”ã§å£ã‚’ãƒ‘ã‚¯ãƒ‘ã‚¯ã•ã›ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã€‚å°†æ¥çš„ãªéŸ³ç´ è§£æå¯¾å¿œã¸ã®æ‹¡å¼µæ€§ã‚’æŒãŸã›ãŸè¨­è¨ˆã¨ã™ã‚‹ã€‚

---

## ç›®æ¬¡

1. [è¦ä»¶å®šç¾©](#è¦ä»¶å®šç¾©)
2. [è¨­è¨ˆæ–¹é‡](#è¨­è¨ˆæ–¹é‡)
3. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ)
4. [ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ](#ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ )
5. [å®Ÿè£…è¨ˆç”»](#å®Ÿè£…è¨ˆç”»)
6. [ä½¿ç”¨ä¾‹](#ä½¿ç”¨ä¾‹)
7. [å°†æ¥ã®æ‹¡å¼µ](#å°†æ¥ã®æ‹¡å¼µ)

---

## è¦ä»¶å®šç¾©

### MVP æ©Ÿèƒ½è¦ä»¶

#### 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
- âœ… **ãƒ‘ãƒ¼ãƒ„åˆ†é›¢**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’è¤‡æ•°ã®ãƒ‘ãƒ¼ãƒ„(ãƒ™ãƒ¼ã‚¹ã€ç›®ã€å£ã€é«ªãªã©)ã«åˆ†é›¢ã—ã¦å®šç¾©
- âœ… **ãƒ‘ãƒ¼ãƒ„çµ„ã¿åˆã‚ã›**: å„ãƒ‘ãƒ¼ãƒ„ã®çŠ¶æ…‹ã‚’çµ„ã¿åˆã‚ã›ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨æƒ…ã‚’æ§‹æˆ
- âœ… **é€æ˜åº¦å¯¾å¿œ**: PNG é€éç”»åƒã§å„ãƒ‘ãƒ¼ãƒ„ã‚’é‡ã­åˆã‚ã›

#### 2. ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯æ©Ÿèƒ½ (MVP)
- âœ… **ãƒ‘ã‚¯ãƒ‘ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ç™ºè©±ä¸­ã«ä¸€å®šé–“éš”ã§å£ã‚’é–‹é–‰
- âœ… **ã‚¿ã‚¤ãƒŸãƒ³ã‚°åŒæœŸ**: éŸ³å£°ã®é–‹å§‹/çµ‚äº†ã«åˆã‚ã›ã¦å£ãƒ‘ã‚¯ã‚’åˆ¶å¾¡
- âœ… **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½**: å£ãƒ‘ã‚¯é€Ÿåº¦ãƒ»å£ã®å½¢çŠ¶ã‚’è¨­å®šå¯èƒ½
- ğŸ”® **å°†æ¥å¯¾å¿œ**: éŸ³ç´ è§£æãƒ™ãƒ¼ã‚¹ã®ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã¸ã®æ‹¡å¼µæ€§ã‚’ç¢ºä¿

#### 3. ç›®ã®å‹•ã
- âœ… **è‡ªå‹•ç¬ã**: ä¸€å®šé–“éš”ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ç¬ã
- âœ… **ç¬ãã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**: ç¬ãé »åº¦ãƒ»é€Ÿåº¦ã®èª¿æ•´
- âœ… **è¡¨æƒ…é€£å‹•**: è¡¨æƒ…çŠ¶æ…‹ã«å¿œã˜ãŸç›®ã®å¤‰åŒ–

#### 4. ãã®ä»–ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **å‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: è‡ªç„¶ãªå‘¼å¸ã®å‹•ã
- âœ… **é ·ããƒ»æºã‚Œ**: æ„Ÿæƒ…è¡¨ç¾ã«å¿œã˜ãŸå‹•ã
- âœ… **è¡¨æƒ…é·ç§»**: è¡¨æƒ…åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰

### éæ©Ÿèƒ½è¦ä»¶

- ğŸ”§ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã¯ä¸è¦ã€å‹•ç”»ç”Ÿæˆæ™‚ã«å‡¦ç†
- ğŸ”§ **æ‹¡å¼µæ€§**: å°†æ¥çš„ã«éŸ³ç´ è§£æã€Live2Dã€VRM ãƒ¢ãƒ‡ãƒ«å¯¾å¿œå¯èƒ½ãªè¨­è¨ˆ
- ğŸ”§ **äº’æ›æ€§**: æ—¢å­˜ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ (06_character_system.md)ã¨çµ±åˆ
- ğŸ”§ **ä½¿ã„ã‚„ã™ã•**: AI ãŒç”Ÿæˆã—ã‚„ã™ã„ JSON æ§‹é€ 

---

## è¨­è¨ˆæ–¹é‡

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é¸æŠ

| é …ç›® | MVP æ–¹é‡ | å°†æ¥ã®æ‹¡å¼µ |
|------|---------|-----------|
| ãƒ‘ãƒ¼ãƒ„ã‚·ã‚¹ãƒ†ãƒ  | ãƒ¬ã‚¤ãƒ¤ãƒ¼æ–¹å¼ | å¤‰æ›´ãªã— |
| ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ | **å›ºå®šé–“éš”ãƒ‘ã‚¯ãƒ‘ã‚¯æ–¹å¼** | **éŸ³ç´ ãƒãƒƒãƒ”ãƒ³ã‚°æ–¹å¼** |
| å£ã®å½¢çŠ¶ | 1ç¨®é¡(é–‹ãå£) + é–‰ã˜å£ | 5æ¯éŸ³ãƒ™ãƒ¼ã‚¹(ã‚ã„ã†ãˆãŠ) |
| éŸ³å£°è§£æ | **ä¸è¦** | **Google Cloud TTS ã®éŸ³ç´ æƒ…å ±æ´»ç”¨** |
| ç¬ãç”Ÿæˆ | ãƒ©ãƒ³ãƒ€ãƒ  + ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ | å¤‰æ›´ãªã— |

### MVP ã®åˆ©ç‚¹

- âœ… **å®Ÿè£…æœŸé–“çŸ­ç¸®**: éŸ³ç´ è§£æã‚’çœç•¥ã€ç´„15æ—¥ã§å®Œæˆ
- âœ… **ååˆ†ãªè¡¨ç¾åŠ›**: è¦–è´è€…ã«ã¯è‡ªç„¶ã«è¦‹ãˆã‚‹å£ãƒ‘ã‚¯
- âœ… **è»½é‡å‡¦ç†**: è¤‡é›‘ãªéŸ³å£°è§£æãŒä¸è¦
- âœ… **æ‹¡å¼µå¯èƒ½**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’çµ±ä¸€ã—ã€å°†æ¥ã®éŸ³ç´ è§£æå¯¾å¿œãŒå®¹æ˜“

### æ‹¡å¼µæ€§ã®ç¢ºä¿

ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æŠ½è±¡åŒ–ã—ã€å®Ÿè£…ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã™ã‚‹:

```python
class LipSyncEngine(ABC):
    """ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹"""

    @abstractmethod
    def generate_mouth_keyframes(
        self,
        audio_path: str,
        text: str,
        start_time: float,
        duration: float,
        config: LipSyncConfig
    ) -> list[MouthKeyframe]:
        """å£ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆ"""
        pass

class SimplePakuPakuEngine(LipSyncEngine):
    """ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¯ãƒ‘ã‚¯æ–¹å¼(MVP)"""
    pass

class PhonemeMappingEngine(LipSyncEngine):
    """éŸ³ç´ ãƒãƒƒãƒ”ãƒ³ã‚°æ–¹å¼(å°†æ¥å®Ÿè£…)"""
    pass
```

### æ®µéšçš„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### Phase 1: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  (åŸºæœ¬)
- ãƒ‘ãƒ¼ãƒ„ãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
- ãƒ‘ãƒ¼ãƒ„çµ„ã¿åˆã‚ã›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- é™çš„ãªè¡¨æƒ…åˆ‡ã‚Šæ›¿ãˆ

#### Phase 2: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ (MVP - ã‚³ã‚¢æ©Ÿèƒ½)
- å›ºå®šé–“éš”ãƒ‘ã‚¯ãƒ‘ã‚¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°åŒæœŸ
- å£ã®å½¢çŠ¶åˆ‡ã‚Šæ›¿ãˆ

#### Phase 3: ç›®ã®å‹•ã
- è‡ªå‹•ç¬ãã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ç¬ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

#### Phase 4: é«˜åº¦ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- è¡¨æƒ…é·ç§»ã®ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰
- å‘¼å¸ãƒ»æºã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

### 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©

```python
from pydantic import BaseModel, Field
from enum import Enum
from abc import ABC, abstractmethod

class CharacterPartType(str, Enum):
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‘ãƒ¼ãƒ„ã‚¿ã‚¤ãƒ—"""
    BASE = "base"              # ãƒ™ãƒ¼ã‚¹(é¡”ã®è¼ªéƒ­ã€ä½“ãªã©)
    EYES = "eyes"              # ç›®
    MOUTH = "mouth"            # å£
    EYEBROWS = "eyebrows"      # çœ‰
    HAIR = "hair"              # é«ª
    ACCESSORY = "accessory"    # ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼
    EFFECT = "effect"          # ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ(æ±—ã€é ¬ã®èµ¤ã¿ãªã©)

class MouthShape(str, Enum):
    """å£ã®å½¢çŠ¶ã‚¿ã‚¤ãƒ—"""
    CLOSED = "closed"          # é–‰ã˜å£
    OPEN = "open"              # é–‹ãå£(MVPç”¨)
    # å°†æ¥ã®æ‹¡å¼µç”¨
    A = "a"                    # ã‚
    I = "i"                    # ã„
    U = "u"                    # ã†
    E = "e"                    # ãˆ
    O = "o"                    # ãŠ
    SMILE = "smile"            # ç¬‘é¡”(æ­¯ã‚’è¦‹ã›ã‚‹)
    NEUTRAL = "neutral"        # ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«(ãƒªãƒ©ãƒƒã‚¯ã‚¹)

class EyeState(str, Enum):
    """ç›®ã®çŠ¶æ…‹"""
    OPEN = "open"              # é–‹ã„ã¦ã„ã‚‹
    CLOSED = "closed"          # é–‰ã˜ã¦ã„ã‚‹
    HALF = "half"              # åŠç›®
    SMILE = "smile"            # ç¬‘é¡”(ç›®ã‚’ç´°ã‚ã‚‹)
    WIDE = "wide"              # è¦‹é–‹ã
    SURPRISED = "surprised"    # é©šã

class CharacterPart(BaseModel):
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‘ãƒ¼ãƒ„å®šç¾©"""

    type: CharacterPartType = Field(..., description="ãƒ‘ãƒ¼ãƒ„ã‚¿ã‚¤ãƒ—")
    name: str = Field(..., description="ãƒ‘ãƒ¼ãƒ„å(è­˜åˆ¥ç”¨)")
    path: str = Field(..., description="ãƒ‘ãƒ¼ãƒ„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹")

    # ä½ç½®èª¿æ•´(ãƒ™ãƒ¼ã‚¹ç”»åƒã«å¯¾ã™ã‚‹ç›¸å¯¾ä½ç½®)
    offset_x: int = Field(0, description="Xæ–¹å‘ã‚ªãƒ•ã‚»ãƒƒãƒˆ(px)")
    offset_y: int = Field(0, description="Yæ–¹å‘ã‚ªãƒ•ã‚»ãƒƒãƒˆ(px)")

    # Z-index (ãƒ¬ã‚¤ãƒ¤ãƒ¼é †åº)
    z_index: int = Field(0, description="Zé †åº(å¤§ãã„ã»ã©å‰é¢)")

class LipSyncMode(str, Enum):
    """ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ‰"""
    SIMPLE_PAKU_PAKU = "simple_paku_paku"  # ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¯ãƒ‘ã‚¯(MVP)
    PHONEME_MAPPING = "phoneme_mapping"     # éŸ³ç´ ãƒãƒƒãƒ”ãƒ³ã‚°(å°†æ¥å®Ÿè£…)
    DISABLED = "disabled"                   # ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ç„¡åŠ¹

class LipSyncConfig(BaseModel):
    """ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯è¨­å®š"""

    mode: LipSyncMode = Field(
        LipSyncMode.SIMPLE_PAKU_PAKU,
        description="ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ‰"
    )

    # === ã‚·ãƒ³ãƒ—ãƒ«ãƒ‘ã‚¯ãƒ‘ã‚¯æ–¹å¼ã®è¨­å®š (MVP) ===
    paku_interval: float = Field(
        0.15,
        description="å£ã®é–‹é–‰é–“éš”(ç§’)",
        ge=0.05, le=0.5
    )
    paku_open_shape: MouthShape = Field(
        MouthShape.OPEN,
        description="å£ã‚’é–‹ãæ™‚ã®å½¢çŠ¶"
    )
    paku_closed_shape: MouthShape = Field(
        MouthShape.CLOSED,
        description="å£ã‚’é–‰ã˜ã‚‹æ™‚ã®å½¢çŠ¶"
    )
    paku_transition_duration: float = Field(
        0.05,
        description="å£ã®é–‹é–‰é·ç§»æ™‚é–“(ç§’)",
        ge=0.01, le=0.1
    )

    # === éŸ³ç´ ãƒãƒƒãƒ”ãƒ³ã‚°æ–¹å¼ã®è¨­å®š (å°†æ¥å®Ÿè£…) ===
    phoneme_map: dict[str, MouthShape] | None = Field(
        None,
        description="éŸ³ç´ â†’å£ã®å½¢çŠ¶ãƒãƒƒãƒ”ãƒ³ã‚°(phoneme_mapping ãƒ¢ãƒ¼ãƒ‰ç”¨)"
    )
    mouth_open_duration: float = Field(
        0.1,
        description="å£ã‚’é–‹ã‘ã‚‹å‹•ä½œã®æ™‚é–“(ç§’)",
        ge=0.05, le=0.3
    )
    mouth_close_duration: float = Field(
        0.1,
        description="å£ã‚’é–‰ã˜ã‚‹å‹•ä½œã®æ™‚é–“(ç§’)",
        ge=0.05, le=0.3
    )
    default_mouth_hold: float = Field(
        0.15,
        description="å£ã®å½¢çŠ¶ã‚’ä¿æŒã™ã‚‹æ™‚é–“(ç§’)",
        ge=0.1, le=0.5
    )

class BlinkConfig(BaseModel):
    """è‡ªå‹•ç¬ãè¨­å®š"""

    enabled: bool = Field(True, description="è‡ªå‹•ç¬ãæœ‰åŠ¹åŒ–")

    # ç¬ãé »åº¦(ç§’)
    blink_interval_min: float = Field(
        2.0,
        description="ç¬ãé–“éš”ã®æœ€å°å€¤(ç§’)",
        ge=0.5
    )
    blink_interval_max: float = Field(
        5.0,
        description="ç¬ãé–“éš”ã®æœ€å¤§å€¤(ç§’)",
        ge=1.0
    )

    # ç¬ãå‹•ä½œã®é€Ÿåº¦
    blink_duration: float = Field(
        0.15,
        description="ç¬ã1å›ã®æ™‚é–“(ç§’)",
        ge=0.05, le=0.3
    )

    # ç¬ãæŠ‘åˆ¶(ç™ºè©±ä¸­ã¯ç¬ãã‚’æ¸›ã‚‰ã™)
    suppress_during_speech: bool = Field(
        True,
        description="ç™ºè©±ä¸­ã®ç¬ãã‚’æŠ‘åˆ¶"
    )

class LayeredCharacterDefinition(BaseModel):
    """ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©"""

    id: str = Field(..., description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è­˜åˆ¥å­")
    name: str = Field(..., description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å")

    # ãƒ‘ãƒ¼ãƒ„å®šç¾©
    parts: dict[str, list[CharacterPart]] = Field(
        ...,
        description="ãƒ‘ãƒ¼ãƒ„ã‚°ãƒ«ãƒ¼ãƒ—ã€‚ã‚­ãƒ¼ã¯çŠ¶æ…‹å(ä¾‹: 'eyes.open', 'mouth.open')"
    )

    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹
    default_parts: dict[CharacterPartType, str] = Field(
        ...,
        description="å„ãƒ‘ãƒ¼ãƒ„ã‚¿ã‚¤ãƒ—ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹å"
    )

    # ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯è¨­å®š
    lip_sync: LipSyncConfig = Field(
        default_factory=LipSyncConfig,
        description="ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯è¨­å®š"
    )

    # ç¬ãè¨­å®š
    blink: BlinkConfig = Field(
        default_factory=BlinkConfig,
        description="è‡ªå‹•ç¬ãè¨­å®š"
    )

    # é…ç½®è¨­å®š
    position: "CharacterPosition" = Field(
        "bottom-right",
        description="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé…ç½®ä½ç½®"
    )
    custom_position: tuple[int, int] | None = Field(
        None,
        description="ã‚«ã‚¹ã‚¿ãƒ ä½ç½®(x, y)"
    )
    scale: float = Field(
        1.0,
        description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚µã‚¤ã‚ºå€ç‡",
        gt=0, le=3.0
    )

    # éŸ³å£°é€£æº(ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«)
    voice_profile: str | None = Field(
        None,
        description="ã“ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ç´ã¥ããƒœã‚¤ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å"
    )
```

### 2. ãƒ‘ãƒ¼ãƒ„çŠ¶æ…‹æŒ‡å®š(Narration Segment ãƒ¬ãƒ™ãƒ«)

```python
class CharacterPartState(BaseModel):
    """ãƒ‘ãƒ¼ãƒ„çŠ¶æ…‹æŒ‡å®š"""

    part_type: CharacterPartType = Field(..., description="ãƒ‘ãƒ¼ãƒ„ã‚¿ã‚¤ãƒ—")
    state_name: str = Field(..., description="çŠ¶æ…‹å")

class LayeredCharacterState(BaseModel):
    """ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹(Segment ãƒ¬ãƒ™ãƒ«)"""

    character_id: str = Field(..., description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ID")

    # ãƒ‘ãƒ¼ãƒ„çŠ¶æ…‹ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
    part_states: list[CharacterPartState] = Field(
        default_factory=list,
        description="ãƒ‘ãƒ¼ãƒ„çŠ¶æ…‹ãƒªã‚¹ãƒˆ(æŒ‡å®šãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)"
    )

    # ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯è¨­å®š
    lip_sync_enabled: bool | None = Field(
        None,
        description="ã“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯æœ‰åŠ¹åŒ–(None=ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨)"
    )

    # ç¬ãè¨­å®š
    blink_enabled: bool | None = Field(
        None,
        description="ã“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç¬ãæœ‰åŠ¹åŒ–(None=ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨)"
    )

    visible: bool = Field(True, description="è¡¨ç¤º/éè¡¨ç¤º")

# NarrationSegment ã¸ã®è¿½åŠ 
class NarrationSegment(BaseModel):
    # ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

    # ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹
    layered_character_states: list[LayeredCharacterState] = Field(
        default_factory=list,
        description="ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ãƒªã‚¹ãƒˆ"
    )
```

### 3. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”¨ãƒ¢ãƒ‡ãƒ«(Project ãƒ¬ãƒ™ãƒ«)

```python
class MouthKeyframe(BaseModel):
    """å£ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ """

    time: float = Field(..., description="æ™‚åˆ»(ç§’)")
    shape: MouthShape = Field(..., description="å£ã®å½¢çŠ¶")
    opacity: float = Field(1.0, description="ä¸é€æ˜åº¦(é·ç§»ç”¨)", ge=0.0, le=1.0)

class EyeKeyframe(BaseModel):
    """ç›®ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ """

    time: float = Field(..., description="æ™‚åˆ»(ç§’)")
    state: EyeState = Field(..., description="ç›®ã®çŠ¶æ…‹")
    opacity: float = Field(1.0, description="ä¸é€æ˜åº¦(é·ç§»ç”¨)", ge=0.0, le=1.0)

class LayeredCharacterLayer(BaseModel):
    """ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼(å®Ÿè¡Œç”¨)"""

    # è­˜åˆ¥æƒ…å ±
    character_id: str = Field(..., description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ID")
    character_name: str = Field(..., description="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å")

    # ã‚¿ã‚¤ãƒŸãƒ³ã‚°
    start_time: float = Field(..., description="é–‹å§‹æ™‚åˆ»(ç§’)")
    end_time: float = Field(..., description="çµ‚äº†æ™‚åˆ»(ç§’)")

    # ãƒ‘ãƒ¼ãƒ„æ§‹æˆ
    parts: list[CharacterPart] = Field(..., description="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ãƒ‘ãƒ¼ãƒ„ãƒªã‚¹ãƒˆ")

    # ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
    mouth_keyframes: list[MouthKeyframe] = Field(
        default_factory=list,
        description="å£ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒªã‚¹ãƒˆ"
    )
    eye_keyframes: list[EyeKeyframe] = Field(
        default_factory=list,
        description="ç›®ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒªã‚¹ãƒˆ"
    )

    # é…ç½®ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«
    position: str = Field("bottom-right", description="é…ç½®ä½ç½®")
    custom_position: tuple[int, int] | None = Field(None, description="ã‚«ã‚¹ã‚¿ãƒ ä½ç½®")
    scale: float = Field(1.0, description="ã‚µã‚¤ã‚ºå€ç‡")
    opacity: float = Field(1.0, description="ä¸é€æ˜åº¦")

    # ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    animation: "CharacterAnimation | None" = Field(
        None,
        description="å…¨ä½“ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³(æºã‚Œã€å‘¼å¸ãªã©)"
    )

# Timeline ã¸ã®è¿½åŠ 
class Timeline(BaseModel):
    # ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

    layered_character_layers: list[LayeredCharacterLayer] = Field(
        default_factory=list,
        description="ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ"
    )
```

---

## ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### MVP: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¯ãƒ‘ã‚¯æ–¹å¼

#### ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦

```
ç™ºè©±é–‹å§‹æ™‚åˆ»: start_time
ç™ºè©±çµ‚äº†æ™‚åˆ»: end_time
ãƒ‘ã‚¯ãƒ‘ã‚¯é–“éš”: paku_interval

ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç”Ÿæˆ:
1. start_time: å£ã‚’é–‰ã˜ã‚‹
2. start_time + paku_interval/2: å£ã‚’é–‹ã
3. start_time + paku_interval: å£ã‚’é–‰ã˜ã‚‹
4. start_time + paku_interval*1.5: å£ã‚’é–‹ã
5. ...
6. end_time: å£ã‚’é–‰ã˜ã‚‹
```

#### å®Ÿè£…ä¾‹

```python
class SimplePakuPakuEngine(LipSyncEngine):
    """ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¯ãƒ‘ã‚¯æ–¹å¼ã®ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³(MVP)"""

    def generate_mouth_keyframes(
        self,
        audio_path: str,
        text: str,
        start_time: float,
        duration: float,
        config: LipSyncConfig
    ) -> list[MouthKeyframe]:
        """å£ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆ"""

        keyframes = []
        current_time = start_time
        is_open = False

        # é–‹å§‹æ™‚ã¯é–‰ã˜å£
        keyframes.append(MouthKeyframe(
            time=current_time,
            shape=config.paku_closed_shape,
            opacity=1.0
        ))

        # ãƒ‘ã‚¯ãƒ‘ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        while current_time < start_time + duration:
            # æ¬¡ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚åˆ»
            current_time += config.paku_interval / 2

            if current_time >= start_time + duration:
                break

            # é–‹é–‰ã‚’äº¤äº’ã«
            is_open = not is_open
            shape = config.paku_open_shape if is_open else config.paku_closed_shape

            keyframes.append(MouthKeyframe(
                time=current_time,
                shape=shape,
                opacity=1.0
            ))

        # çµ‚äº†æ™‚ã¯é–‰ã˜å£
        keyframes.append(MouthKeyframe(
            time=start_time + duration,
            shape=config.paku_closed_shape,
            opacity=1.0
        ))

        return keyframes
```

### ç¬ãã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```python
import random

def generate_blink_keyframes(
    start_time: float,
    end_time: float,
    config: BlinkConfig,
    is_speaking: bool = False
) -> list[EyeKeyframe]:
    """ç¬ãã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆ"""

    keyframes = []
    current_time = start_time

    # é–‹å§‹æ™‚ã¯ç›®ã‚’é–‹ã
    keyframes.append(EyeKeyframe(
        time=start_time,
        state=EyeState.OPEN,
        opacity=1.0
    ))

    while current_time < end_time:
        # æ¬¡ã®ç¬ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
        interval = random.uniform(
            config.blink_interval_min,
            config.blink_interval_max
        )

        # ç™ºè©±ä¸­ã¯ç¬ãé »åº¦ã‚’ä¸‹ã’ã‚‹
        if is_speaking and config.suppress_during_speech:
            interval *= 1.5

        next_blink = current_time + interval

        if next_blink >= end_time:
            break

        # ç¬ãé–‹å§‹
        keyframes.append(EyeKeyframe(
            time=next_blink,
            state=EyeState.CLOSED,
            opacity=1.0
        ))

        # ç¬ãçµ‚äº†(ç›®ã‚’é–‹ã‘ã‚‹)
        keyframes.append(EyeKeyframe(
            time=next_blink + config.blink_duration,
            state=EyeState.OPEN,
            opacity=1.0
        ))

        current_time = next_blink + config.blink_duration

    # çµ‚äº†æ™‚ã¯ç›®ã‚’é–‹ã
    keyframes.append(EyeKeyframe(
        time=end_time,
        state=EyeState.OPEN,
        opacity=1.0
    ))

    return keyframes
```

---

## å®Ÿè£…è¨ˆç”»

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/script/models.py`

#### ã‚¿ã‚¹ã‚¯
1. âœ… `CharacterPartType`, `MouthShape`, `EyeState` Enum è¿½åŠ 
2. âœ… `CharacterPart`, `LayeredCharacterDefinition` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
3. âœ… `LipSyncMode`, `LipSyncConfig`, `BlinkConfig` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
4. âœ… `CharacterPartState`, `LayeredCharacterState` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
5. âœ… `NarrationSegment` ã« `layered_character_states` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
6. âœ… `Script` ã« `layered_characters` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/layer/models.py`

#### ã‚¿ã‚¹ã‚¯
7. âœ… `MouthKeyframe`, `EyeKeyframe` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
8. âœ… `LayeredCharacterLayer` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
9. âœ… `Timeline` ã« `layered_character_layers` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

**å·¥æ•°**: 2æ—¥

---

### Phase 2: ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£… (MVP)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/animation/lip_sync.py` (æ–°è¦)

#### ã‚¿ã‚¹ã‚¯
1. âœ… `LipSyncEngine` æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹å®Ÿè£…
2. âœ… `SimplePakuPakuEngine` å®Ÿè£…(MVP)
3. âœ… ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼å®Ÿè£…
4. ğŸ”® `PhonemeMappingEngine` ã‚¹ã‚¿ãƒ–å®Ÿè£…(å°†æ¥ç”¨)

**å·¥æ•°**: 2æ—¥

---

### Phase 3: ç¬ãã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/animation/blink.py` (æ–°è¦)

#### ã‚¿ã‚¹ã‚¯
1. âœ… `generate_blink_keyframes()` é–¢æ•°å®Ÿè£…
2. âœ… ãƒ©ãƒ³ãƒ€ãƒ ç¬ãç”Ÿæˆ
3. âœ… ç™ºè©±ä¸­ã®ç¬ãæŠ‘åˆ¶ãƒ­ã‚¸ãƒƒã‚¯
4. âœ… ã‚·ãƒ¼ãƒ‰å€¤ã«ã‚ˆã‚‹å†ç¾æ€§ç¢ºä¿

**å·¥æ•°**: 2æ—¥

---

### Phase 4: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/script/compiler.py`

#### ã‚¿ã‚¹ã‚¯
1. âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©ã®è§£æ
2. âœ… ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³ã®çµ±åˆ
3. âœ… ç¬ãã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç”Ÿæˆã®çµ±åˆ
4. âœ… `LayeredCharacterLayer` ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
5. âœ… éŸ³å£°ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã®å–å¾—(AudioLayer ã‹ã‚‰)

**å·¥æ•°**: 3æ—¥

---

### Phase 5: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/layer/processors/layered_character.py` (æ–°è¦)

#### ã‚¿ã‚¹ã‚¯
1. âœ… `LayeredCharacterProcessor` ã‚¯ãƒ©ã‚¹å®Ÿè£…
2. âœ… ãƒ‘ãƒ¼ãƒ„ç”»åƒã®èª­ã¿è¾¼ã¿
3. âœ… ãƒ‘ãƒ¼ãƒ„ã®é‡ã­åˆã‚ã›(Z-index é †)
4. âœ… ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã«åŸºã¥ããƒ‘ãƒ¼ãƒ„åˆ‡ã‚Šæ›¿ãˆ
5. âœ… ä½ç½®ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»ä¸é€æ˜åº¦ã®é©ç”¨
6. âœ… ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“ãƒ­ã‚¸ãƒƒã‚¯

**å·¥æ•°**: 3æ—¥

---

### Phase 6: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/generator/steps/layered_character_layer.py` (æ–°è¦)

#### ã‚¿ã‚¹ã‚¯
1. âœ… `LayeredCharacterLayerProcessingStep` å®Ÿè£…
2. âœ… ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“ãƒ­ã‚¸ãƒƒã‚¯(ãƒ•ãƒ¬ãƒ¼ãƒ å˜ä½)
3. âœ… moviepy ã¨ã®çµ±åˆ
4. âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿

**å·¥æ•°**: 2æ—¥

---

### Phase 7: ãƒ†ã‚¹ãƒˆå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/tests/`

#### ã‚¿ã‚¹ã‚¯
1. âœ… SimplePakuPakuEngine ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
2. âœ… ç¬ãã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
3. âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ
4. âœ… E2E ãƒ†ã‚¹ãƒˆ(JSON â†’ å‹•ç”»ç”Ÿæˆ)

**å·¥æ•°**: 2æ—¥

---

### Phase 8: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚µãƒ³ãƒ—ãƒ«ä½œæˆ

#### ã‚¿ã‚¹ã‚¯
1. âœ… API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
2. âœ… ã‚µãƒ³ãƒ—ãƒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç´ æã®ä½œæˆ
   - ãƒ™ãƒ¼ã‚¹ç”»åƒ
   - å£ãƒ‘ãƒ¼ãƒ„(é–‰ã˜å£ã€é–‹ãå£)
   - ç›®ãƒ‘ãƒ¼ãƒ„(é–‹ãã€é–‰ã˜ã€åŠç›®)
3. âœ… ã‚µãƒ³ãƒ—ãƒ« JSON ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
4. âœ… ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**å·¥æ•°**: 2æ—¥

---

### å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«(æ¨å®š)

| Phase | å†…å®¹ | å·¥æ•°(æ—¥) |
|-------|------|---------|
| Phase 1 | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®Ÿè£… | 2 |
| Phase 2 | ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…(MVP) | 2 |
| Phase 3 | ç¬ãã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£… | 2 |
| Phase 4 | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ‹¡å¼µ | 3 |
| Phase 5 | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼å®Ÿè£… | 3 |
| Phase 6 | ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ | 2 |
| Phase 7 | ãƒ†ã‚¹ãƒˆå®Ÿè£… | 2 |
| Phase 8 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚µãƒ³ãƒ—ãƒ«ä½œæˆ | 2 |
| **åˆè¨ˆ** | | **18æ—¥** |

â€» éŸ³ç´ è§£æã‚’çœç•¥ã—ãŸãŸã‚ã€27æ—¥ â†’ 18æ—¥ã«çŸ­ç¸®

---

## ä½¿ç”¨ä¾‹

### 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾© (MVPç”¨)

```json
{
  "layered_characters": {
    "teto": {
      "id": "teto",
      "name": "ãƒ†ãƒˆ",
      "parts": {
        "base": [
          {
            "type": "base",
            "name": "body",
            "path": "assets/teto/base.png",
            "z_index": 0
          }
        ],
        "eyes.open": [
          {
            "type": "eyes",
            "name": "eyes_open",
            "path": "assets/teto/eyes_open.png",
            "z_index": 2
          }
        ],
        "eyes.closed": [
          {
            "type": "eyes",
            "name": "eyes_closed",
            "path": "assets/teto/eyes_closed.png",
            "z_index": 2
          }
        ],
        "eyes.smile": [
          {
            "type": "eyes",
            "name": "eyes_smile",
            "path": "assets/teto/eyes_smile.png",
            "z_index": 2
          }
        ],
        "mouth.closed": [
          {
            "type": "mouth",
            "name": "mouth_closed",
            "path": "assets/teto/mouth_closed.png",
            "z_index": 3
          }
        ],
        "mouth.open": [
          {
            "type": "mouth",
            "name": "mouth_open",
            "path": "assets/teto/mouth_open.png",
            "z_index": 3
          }
        ],
        "hair": [
          {
            "type": "hair",
            "name": "hair_front",
            "path": "assets/teto/hair.png",
            "z_index": 4
          }
        ]
      },
      "default_parts": {
        "base": "base",
        "eyes": "eyes.open",
        "mouth": "mouth.closed",
        "hair": "hair"
      },
      "lip_sync": {
        "mode": "simple_paku_paku",
        "paku_interval": 0.15,
        "paku_open_shape": "open",
        "paku_closed_shape": "closed"
      },
      "blink": {
        "enabled": true,
        "blink_interval_min": 2.0,
        "blink_interval_max": 4.5,
        "blink_duration": 0.12,
        "suppress_during_speech": true
      }
    }
  }
}
```

### 2. ã‚·ãƒ¼ãƒ³ã§ã®ä½¿ç”¨

```json
{
  "scenes": [
    {
      "visual": {
        "path": "background.jpg"
      },
      "narrations": [
        {
          "text": "ã“ã‚“ã«ã¡ã¯!ä»Šæ—¥ã¯Tetoã®ä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚",
          "layered_character_states": [
            {
              "character_id": "teto",
              "part_states": [
                {
                  "part_type": "eyes",
                  "state_name": "eyes.smile"
                }
              ],
              "lip_sync_enabled": true,
              "blink_enabled": true
            }
          ]
        },
        {
          "text": "å®Ÿã¯ã™ã”ã„æ©Ÿèƒ½ãŒã‚ã‚‹ã‚“ã§ã™!",
          "layered_character_states": [
            {
              "character_id": "teto",
              "part_states": [
                {
                  "part_type": "eyes",
                  "state_name": "eyes.wide"
                }
              ],
              "lip_sync_enabled": true,
              "blink_enabled": false
            }
          ]
        }
      ]
    }
  ]
}
```

### 3. Python API

```python
from teto_core.script.models import (
    Script, Scene, NarrationSegment,
    LayeredCharacterDefinition, CharacterPart,
    LayeredCharacterState, CharacterPartState,
    LipSyncConfig, BlinkConfig, LipSyncMode,
    CharacterPartType, MouthShape, EyeState
)

# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
teto = LayeredCharacterDefinition(
    id="teto",
    name="ãƒ†ãƒˆ",
    parts={
        "base": [
            CharacterPart(
                type=CharacterPartType.BASE,
                name="body",
                path="assets/teto/base.png",
                z_index=0
            )
        ],
        "eyes.open": [
            CharacterPart(
                type=CharacterPartType.EYES,
                name="eyes_open",
                path="assets/teto/eyes_open.png",
                z_index=2
            )
        ],
        "mouth.closed": [
            CharacterPart(
                type=CharacterPartType.MOUTH,
                name="mouth_closed",
                path="assets/teto/mouth_closed.png",
                z_index=3
            )
        ],
        "mouth.open": [
            CharacterPart(
                type=CharacterPartType.MOUTH,
                name="mouth_open",
                path="assets/teto/mouth_open.png",
                z_index=3
            )
        ],
    },
    default_parts={
        CharacterPartType.BASE: "base",
        CharacterPartType.EYES: "eyes.open",
        CharacterPartType.MOUTH: "mouth.closed",
    },
    lip_sync=LipSyncConfig(
        mode=LipSyncMode.SIMPLE_PAKU_PAKU,
        paku_interval=0.15,
        paku_open_shape=MouthShape.OPEN,
        paku_closed_shape=MouthShape.CLOSED
    ),
    blink=BlinkConfig(
        enabled=True,
        blink_interval_min=2.0,
        blink_interval_max=4.5
    )
)

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
script = Script(
    title="ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ãƒ‡ãƒ¢",
    layered_characters={"teto": teto},
    scenes=[
        Scene(
            visual={"path": "bg.jpg"},
            narrations=[
                NarrationSegment(
                    text="ã“ã‚“ã«ã¡ã¯!",
                    layered_character_states=[
                        LayeredCharacterState(
                            character_id="teto",
                            part_states=[
                                CharacterPartState(
                                    part_type=CharacterPartType.EYES,
                                    state_name="eyes.smile"
                                )
                            ],
                            lip_sync_enabled=True,
                            blink_enabled=True
                        )
                    ]
                )
            ]
        )
    ]
)
```

---

## å°†æ¥ã®æ‹¡å¼µ

### 1. éŸ³ç´ è§£æãƒ™ãƒ¼ã‚¹ã®ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯

**å®Ÿè£…æ™‚ã®è¿½åŠ ä½œæ¥­**:

#### Phase A: éŸ³ç´ æŠ½å‡ºå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/tts/phoneme_extractor.py` (æ–°è¦)

- Google Cloud TTS ã‹ã‚‰éŸ³ç´ æƒ…å ±ã‚’å–å¾—
- SSML ãƒãƒ¼ã‚¯ä½¿ç”¨
- éŸ³ç´ æŠ½å‡ºã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: SimplePakuPakuEngine

#### Phase B: PhonemeMappingEngine å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/teto_core/animation/lip_sync.py`

- `PhonemeMappingEngine` ã‚¯ãƒ©ã‚¹å®Ÿè£…
- éŸ³ç´ â†’å£ã®å½¢çŠ¶ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
- æ¯éŸ³æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯

#### Phase C: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç´ ææ‹¡å¼µ

- 5æ¯éŸ³ãƒ‘ãƒ¼ãƒ„(ã‚ã„ã†ãˆãŠ)ã®è¿½åŠ 

**è¿½åŠ å·¥æ•°**: ç´„9æ—¥

### 2. Live2D / VRM å¯¾å¿œ
- Live2D ãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ(.moc3 ãƒ•ã‚¡ã‚¤ãƒ«)
- VRM ãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ(3D ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼)
- ç‰©ç†æ¼”ç®—(é«ªãƒ»æœã®æºã‚Œ)

### 3. è¡¨æƒ…ã®é«˜åº¦åŒ–
- è¡¨æƒ…é·ç§»ã®ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰
- å¾®è¡¨æƒ…(çœ‰ã®å‹•ãã€é ¬ã®èµ¤ã¿)
- è¦–ç·šåˆ¶å¾¡(ç›®ã®å‘ããƒ»è¦–ç·šè¿½å¾“)

### 4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼(ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª)
- ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¨ãƒ‡ã‚£ã‚¿(GUI)

---

## æŠ€è¡“çš„èª²é¡Œã¨å¯¾ç­–

### èª²é¡Œ1: ãƒ‘ãƒ¼ãƒ„ç”»åƒã®ä½ç½®åˆã‚ã›

**å•é¡Œ**: ãƒ‘ãƒ¼ãƒ„ç”»åƒã®ã‚µã‚¤ã‚ºãƒ»ä½ç½®ãŒã‚ºãƒ¬ã‚‹

**å¯¾ç­–**:
- ãƒ‘ãƒ¼ãƒ„ç”»åƒä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æ•´å‚™
- offset_x, offset_y ã«ã‚ˆã‚‹å¾®èª¿æ•´æ©Ÿèƒ½
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã§ã®ç¢ºèª

### èª²é¡Œ2: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

**å•é¡Œ**: ãƒ‘ãƒ¼ãƒ„ã®é‡ã­åˆã‚ã›å‡¦ç†ãŒãƒ•ãƒ¬ãƒ¼ãƒ æ¯ã«ç™ºç”Ÿã—ã€å‡¦ç†ãŒé‡ã„

**å¯¾ç­–**:
- ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ é–“ã®ãƒ‘ãƒ¼ãƒ„ãŒå¤‰ã‚ã‚‰ãªã„å ´åˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- moviepy ã®æœ€é©åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ´»ç”¨
- ä¸¦åˆ—å‡¦ç†ã®æ´»ç”¨

### èª²é¡Œ3: å£ãƒ‘ã‚¯ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**å•é¡Œ**: å›ºå®šé–“éš”ã®ãƒ‘ã‚¯ãƒ‘ã‚¯ãŒä¸è‡ªç„¶ã«è¦‹ãˆã‚‹å ´åˆãŒã‚ã‚‹

**å¯¾ç­–**:
- paku_interval ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’èª¿æ•´(0.15ç§’)
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½
- å°†æ¥çš„ã«éŸ³ç´ è§£æã¸ç§»è¡Œ

---

## å‚è€ƒè³‡æ–™

- [Google Cloud Text-to-Speech - Timepoint](https://cloud.google.com/text-to-speech/docs/ssml)
- [æ—¥æœ¬èªéŸ³éŸ»è«–](https://ja.wikipedia.org/wiki/%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%81%AE%E9%9F%B3%E9%9F%BB%E8%AB%96)
- [Live2D Cubism SDK](https://www.live2d.com/sdk/)
- [moviepy ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://zulko.github.io/moviepy/)

---

## ã¾ã¨ã‚

ã“ã®è¨­è¨ˆæ›¸ã§ã¯ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯æ©Ÿèƒ½(MVP)ã‚’ Teto ã«çµ±åˆã™ã‚‹è©³ç´°ãªè¨ˆç”»ã‚’ç¤ºã—ã¾ã—ãŸã€‚

### MVP ã®ç‰¹å¾´:
- âœ… **ãƒ‘ãƒ¼ãƒ„ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ **: æŸ”è»Ÿãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¾
- âœ… **ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯**: å›ºå®šé–“éš”ãƒ‘ã‚¯ãƒ‘ã‚¯ã€å®Ÿè£…ãŒå®¹æ˜“
- âœ… **è‡ªå‹•ç¬ã**: è‡ªç„¶ãªç¬ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **æ‹¡å¼µæ€§**: éŸ³ç´ è§£æã€Live2Dã€VRM ã¸ã®å°†æ¥çš„ãªå¯¾å¿œå¯èƒ½
- âœ… **ä½¿ã„ã‚„ã™ã•**: AI ãŒç”Ÿæˆã—ã‚„ã™ã„ JSON æ§‹é€ 

### å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:
- MVP: **18æ—¥**
- éŸ³ç´ è§£æå¯¾å¿œ(å°†æ¥): **+9æ—¥**

ã“ã® MVP ã«ã‚ˆã‚Šã€Teto ã¯æ—©æœŸã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‹•ç”»æ©Ÿèƒ½ã‚’æä¾›ã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ãªãŒã‚‰æ®µéšçš„ã«é«˜åº¦åŒ–ã§ãã¾ã™ã€‚
